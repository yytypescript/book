---
sidebar_label: パッケージのインストール
---

# パッケージのインストール

パッケージマネージャーの基本がわかったところで、実際にパッケージをインストールしてみましょう。

## インストールに必要なもの

パッケージをインストールするには、プロジェクトに`package.json`ファイルが必要です。`package.json`はプロジェクトのメタデータ(名前、バージョン、依存パッケージなど)を管理するファイルです。

まだ`package.json`がない場合は、次のコマンドで作成できます。

```shell
npm init -y
```

`-y`オプションをつけると、すべての項目をデフォルト値で自動設定します。

`package.json`の詳細については、次のページを参照してください。

[package.json](./package-json.md)

## パッケージのインストール方法

### 基本のコマンド

パッケージをインストールするには、`package.json`が存在するディレクトリ(通常はプロジェクトのルートディレクトリ)で`npm install`コマンドにパッケージ名を指定します。たとえば、バリデーションライブラリの`zod`をインストールするには、次のように実行します。

```shell
npm install zod
```

このコマンドを実行すると、次のことが自動的に行われます。

1. パッケージレジストリ(npmjs.com)から`zod`パッケージをダウンロードする
2. プロジェクトの[`node_modules`](./node-modules.md)ディレクトリにファイルを配置する
3. `package.json`の`dependencies`に`zod`を追記する
4. [`package-lock.json`](./lock-file.md)にインストールしたバージョンの詳細を記録する

### 開発用パッケージのインストール

テストツールやTypeScriptコンパイラなど、開発時にだけ必要なパッケージは`-D`オプション(`--save-dev`の省略形)をつけてインストールします。

```shell
npm install -D typescript
```

`-D`をつけると`package.json`の`devDependencies`に記録されます。`-D`なしの場合は`dependencies`に記録されます。この2つの違いについて詳しくは、package.jsonのページを参照してください。

[package.json](./package-json.md)

:::note
OSSのドキュメントなどで`npm install --save-dev`という表記を見かけることがあります。`--save-dev`は`-D`の省略前の正式名で、同じ意味です。
:::

### 他のパッケージマネージャーでのコマンド

npm以外のパッケージマネージャーでも、同様の操作ができます。

| パッケージマネージャー | コマンド          |
| ---------------------- | ----------------- |
| npm                    | `npm install zod` |
| pnpm                   | `pnpm add zod`    |
| Bun                    | `bun add zod`     |
| Yarn                   | `yarn add zod`    |

### ローカルインストールとグローバルインストール

パッケージのインストールには、ローカルインストールとグローバルインストールの2種類があります。

ローカルインストールは、特定のプロジェクト内でのみパッケージを使えるようにするインストール方法です。`npm install`のデフォルトの動作で、プロジェクトの`node_modules`ディレクトリにパッケージが配置されます。

```shell
npm install zod
```

グローバルインストールは、システム全体でパッケージを使えるようにするインストール方法です。`-g`オプションをつけます。コマンドラインツールとして使うパッケージ(`typescript`の`tsc`コマンドなど)をインストールする際に使うことがあります。

```shell
npm install -g typescript
```

:::caution
グローバルインストールは、プロジェクトごとのバージョン管理ができません。特別な理由がない限り、ローカルインストールを使うことをお勧めします。ローカルインストールしたコマンドラインツールは、次に説明する`npx`コマンドで実行できます。
:::

### npxコマンド

npxは、npmに同梱されているコマンド実行ツールです。ローカルインストールしたパッケージのコマンドを直接実行できます。

たとえば、TypeScriptコンパイラをローカルインストールした場合、`npx`を使って実行します。

```shell
npm install -D typescript
npx tsc --version
```

`npx`を使わない場合、`./node_modules/.bin/tsc`のようにフルパスを指定する必要があります。`npx`はこの手間を省いてくれる便利なコマンドです。

また、`npx`はプロジェクトにインストールされていないパッケージを一時的にダウンロードして実行することもできます。プロジェクトの初期化コマンドなど、一度だけ実行したいツールに便利です。

```shell
npx create-next-app my-app
```

他のパッケージマネージャーにも同様のコマンドがあります。

| パッケージマネージャー | コマンド        |
| ---------------------- | --------------- |
| npm                    | `npx tsc`       |
| pnpm                   | `pnpm exec tsc` |
| Bun                    | `bunx tsc`      |
| Yarn                   | `yarn tsc`      |

## バージョン指定

パッケージをインストールするとき、特定のバージョンを指定できます。

```shell
npm install zod@3.22.0
```

`@`の後にバージョン番号を書くことで、そのバージョンをインストールします。バージョンを指定しない場合は、最新バージョンがインストールされます。

`package.json`には、バージョンの範囲を指定する記号が使われることがあります。

| 記号 | 意味                                       | 例        | 範囲                     |
| ---- | ------------------------------------------ | --------- | ------------------------ |
| `^`  | マイナーバージョンまでのアップデートを許可 | `^3.22.0` | `3.22.0`以上`4.0.0`未満  |
| `~`  | パッチバージョンのアップデートのみ許可     | `~3.22.0` | `3.22.0`以上`3.23.0`未満 |
| `*`  | すべてのバージョンを許可                   | `*`       | すべて                   |

`npm install`でパッケージをインストールすると、`package.json`に記録されるバージョンにはデフォルトで`^`(キャレット)が付きます。

## セマンティックバージョニング

バージョン番号の付け方にはセマンティックバージョニング(Semantic Versioning、略してsemver)という業界標準のルールがあります。バージョン番号は「メジャー.マイナー.パッチ」の3つの数字で構成されます。

たとえば、バージョン`3.22.4`は次のように読みます。

- 3 ─ メジャーバージョン
- 22 ─ マイナーバージョン
- 4 ─ パッチバージョン

それぞれの数字が上がる条件は次のとおりです。

| バージョン | 上がる条件                       | 例                   |
| ---------- | -------------------------------- | -------------------- |
| メジャー   | 後方互換性のない変更(破壊的変更) | APIの削除や仕様変更  |
| マイナー   | 後方互換性のある機能追加         | 新しい関数の追加     |
| パッチ     | バグ修正                         | 既存機能の不具合修正 |

このルールがあるおかげで、`^3.22.0`と指定すれば「メジャーバージョンが同じ範囲なら安全にアップデートできる」と判断できます。メジャーバージョンが変わるときだけ、破壊的変更がないか確認すればよいのです。

## パッケージはどこからやってくるか？ ─ パッケージレジストリ

`npm install`を実行すると、パッケージはパッケージレジストリからダウンロードされます。パッケージレジストリとは、パッケージを保管・配布するためのサービスです。

### npmjs.com

npmjs.comは、npm公式のパッケージレジストリです。世界最大のJavaScriptパッケージレジストリで、200万以上のパッケージが公開されています。`npm install`コマンドは、デフォルトでこのレジストリからパッケージをダウンロードします。

パッケージを探すときは、[npmjs.com](https://www.npmjs.com/)のサイトでパッケージ名や機能を検索できます。パッケージの探し方について詳しくは、次のページを参照してください。

[パッケージを探す](./finding-packages.md)

### GitHub Packages

GitHub Packagesは、GitHubが提供するパッケージレジストリです。企業がプライベートなパッケージを社内に配布する用途で使われることが多いです。

### その他のレジストリ

企業によっては、社内専用のプライベートレジストリを運用していることもあります。社内独自のパッケージを安全に配布するために使われます。

:::tip コラム: 新しいレジストリーの動向

JavaScriptのパッケージレジストリには新しい動きもあります。jsr.ioは、Denoチームが開発しているパッケージレジストリです。TypeScriptをネイティブにサポートし、ESモジュール専用という特徴があります。まだ初期段階のサービスですが、TypeScript開発者にとって注目すべき動向です。

:::

<PostILearned>

・npm installでパッケージを追加。-Dで開発用依存に記録
・ローカルインストールが基本。npxでCLIツールを実行可能
・semverは「メジャー.マイナー.パッチ」の3数字構成
・npmjs.comがデフォルトのパッケージレジストリ

</PostILearned>
