# 値渡しと参照渡し

プログラミング言語によっては、引数の渡し方に値渡し(pass-by-value)と参照渡し(pass-by-reference)の2種類が存在するものがあります。

## 値渡し

値渡しは、変数が関数に渡るタイミングで、変数が別の変数にコピーされます。元々同じ変数でも、関数の呼び出し元と関数の内部処理では、独立した値になります。そのため、関数の処理で引数に値を代入しても、関数呼び出し元の変数に影響しません。次は、C言語の値渡しの例です。変数`a`は`1`で初期化され、関数`change`に`a`が渡されます。`change`では引数に`2`を代入しますが、呼び出し元の変数`a`は`1`のままです。

```c
#include <stdio.h>

void change(int n) {
    n = 2;
}

int main() {
    int a = 1;
    change(a);
    printf("%d", a); //=> 1
}
```

## 参照渡し

参照渡しは、関数呼び出し元の変数が関数の処理でも共有されます。もし、関数の処理で引数に値を代入すると、関数呼び出し元の変数も変化します。次のコードはC言語の参照渡しの例です。変数`a`は関数`change`に参照渡しされます。`change`は引数に`2`を代入すると、`change`の呼び出し元の変数`a`の値も`2`になります。

```c
#include <stdio.h>

void change(int *n) {
    *n = 2;
}

int main() {
    int a = 1;
    change(&a);
    printf("%d", a); //=> 2
}
```

## JavaScriptは値渡し

JavaScriptではこのような参照渡しをする機能はありません。関数の引数はすべて値渡しになります。したがって、引数に値を代入する処理を関数に書いても、その影響は関数呼び出し元には影響しません。

```js twoslash
function change(n) {
  n = 2;
}
let n = 1;
change(n);
console.log(n);
// @log: 1
```

ところが、オブジェクトについては少し特殊です。オブジェクトはどこでも参照になります。どういうことかというと、オブジェクトに別の変数名をつけても、オブジェクトが複製されて新たなオブジェクトができるのではなく、異なる変数名同士でひとつのオブジェクトを指すということです。たとえば、次の例のようにオブジェクト`{ n: 1 }`を変数`x`に代入し、さらに`x`を変数`y`に代入すると、`x`と`y`は同じオブジェクトを参照します。もし、`y`のプロパティ`n`を変更すると、`x`の`n`も変化します。

```js twoslash
const x = { n: 1 };
const y = x;
y.n = 2;
console.log(x);
// @log: { n: 2 }
```

ただし、`y`に別の値を代入した場合は、`x`と`y`は共通のオブジェクトを参照しなくなり、`y`への変更は`x`には影響しなくなります。

```js twoslash
const x = { n: 1 };
let y = x;
y = { n: 2 }; // yに別オブジェクトを再代入
y.n = 3;
console.log(x);
// @log: { n: 1 }
```

以上のようにJavaScriptでは、あるオブジェクトに別の変数をつけたとき、そのオブジェクトを共有するようになっています。共有されたオブジェクトはプロパティを変更した場合、他の変数にもその変更が影響します。この仕様は引数にも同じことが言えます。たとえば、次の例です。オブジェクト`{ n: 1 }`を変数`x`代入し、さらに`x`を関数`change`の引数`y`に代入すると、`x`と`y`は同じオブジェクトを参照します。`y`のプロパティを変更すると、その影響は関数呼び出し元の`x`のプロパティにも影響します。

```js twoslash
function change(y) {
  y.n = 2;
}
const x = { n: 1 };
change(x);
console.log(x);
// @log: { n: 2 }
```

引数の場合も、変数の再代入の仕様と同様に、`y`に別の値を代入した場合は、`x`と`y`は同じオブジェクトを参照しなくなるため、`y`への変更は`x`に影響しなくなります。

```js twoslash
function change(y) {
  y = { n: 2 };
  y.n = 3;
}
const x = { n: 1 };
change(x);
console.log(x);
// @log: { n: 1 }
```

以上をまとめると、JavaScriptの関数の引数は値渡しです。注意点として、オブジェクトは変数の場合と同様に、引数と呼び出し元の変数は同じオブジェクトを共有する仕様です。そして、もし引数のオブジェクトのプロパティを変更した場合、その変更は関数呼び出し元に影響します。

<TweetILearned>

・JavaScriptの引数は値渡し
・JavaScriptにはC言語の参照渡しと同等の仕組みはない
・ただし、オブジェクトは値を共有する
・共有したオブジェクトを関数で変更した場合、呼び出し元にも影響する
・オブジェクトの共有は引数に限ったことではない

</TweetILearned>
